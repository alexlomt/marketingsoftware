"use strict";(()=>{var e={};e.id=1495,e.ids=[1495],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5900:e=>{e.exports=require("pg")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},5591:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>m});var a={};r.r(a),r.d(a,{PUT:()=>l});var o=r(5419),n=r(9108),i=r(9678),s=r(8070),u=r(8046);async function l(e){try{let t=e.headers.get("x-user-id");if(!t)return s.Z.json({error:"Authentication required"},{status:401});let{name:r,email:a}=await e.json();if(!r&&!a)return s.Z.json({error:"At least one field must be provided for update"},{status:400});if(a&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return s.Z.json({error:"Invalid email format"},{status:400});let o=await (0,u.getDB)(),n=await (0,u.getRow)(o,"SELECT * FROM users WHERE id = ?",[t]);if(!n)return s.Z.json({error:"User not found"},{status:404});if(a&&a!==n.email&&await (0,u.getRow)(o,"SELECT * FROM users WHERE email = ? AND id != ?",[a,t]))return s.Z.json({error:"Email is already in use"},{status:409});let i={name:r||n.name,email:a||n.email,updated_at:new Date().toISOString()};return await (0,u.updateRow)(o,"users",i,"id = ?",[t]),s.Z.json({message:"Profile updated successfully",user:{id:t,name:i.name,email:i.email,organization_id:n.organization_id,role:n.role}})}catch(e){return console.error("Update profile error:",e),s.Z.json({error:"Failed to update profile"},{status:500})}}r(5813);let c=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/profile/route",pathname:"/api/auth/profile",filename:"route",bundlePath:"app/api/auth/profile/route"},resolvedPagePath:"/home/ubuntu/marketingsoftware/marketingsoftware-main/src/app/api/auth/profile/route.js",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:h,headerHooks:f,staticGenerationBailout:m}=c,w="/api/auth/profile/route";function y(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}},5813:(e,t,r)=>{r.d(t,{Oe:()=>s,RA:()=>u,WX:()=>l,c_:()=>i});var a=r(6521),o=r(6082);r(8046);let n=process.env.JWT_SECRET||"your-secret-key";async function i(e){return(0,a.hash)(e,10)}async function s(e,t){return(0,a.compare)(e,t)}function u(e,t="7d"){return(0,o.sign)(e,n,{expiresIn:t})}function l(e){try{return(0,o.verify)(e,n)}catch(e){return null}}},8046:(e,t,r)=>{r.d(t,{db:()=>i});var a=r(5900),o=r(4107);let n=new a.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});n.on("connect",()=>{console.log("Database connection established")}),n.on("error",e=>{console.error("Unexpected database error:",e)});let i={async query(e,t=[]){let r=await n.connect();try{let a=Date.now(),o=await r.query(e,t),n=Date.now()-a;return n>100&&console.log("Slow query:",{text:e,duration:n,rows:o.rowCount}),o}catch(e){(0,o.dy)(e)}finally{r.release()}},async transaction(e){let t=await n.connect();try{await t.query("BEGIN");let r=await e(t);return await t.query("COMMIT"),r}catch(e){await t.query("ROLLBACK"),(0,o.dy)(e)}finally{t.release()}},async insert(e,t){let r=Object.keys(t),a=Object.values(t),o=r.map((e,t)=>`$${t+1}`).join(", "),n=r.join(", "),i=`
      INSERT INTO ${e} (${n})
      VALUES (${o})
      RETURNING *
    `;return(await this.query(i,a)).rows[0]},async update(e,t,r){let a=Object.keys(r),o=Object.values(r),n=a.map((e,t)=>`${e} = $${t+1}`).join(", "),i=`
      UPDATE ${e}
      SET ${n}, updated_at = CURRENT_TIMESTAMP
      WHERE id = $${a.length+1}
      RETURNING *
    `;return(await this.query(i,[...o,t])).rows[0]},async findWithPagination(e,t={},r={}){let{page:a=1,limit:o=20,orderBy:n="created_at",order:i="DESC",fields:s="*"}=r,u=Object.keys(t),l=Object.values(t),c="";u.length>0&&(c="WHERE "+u.map((e,t)=>null===l[t]?`${e} IS NULL`:`${e} = $${t+1}`).join(" AND "));let d=`
      SELECT COUNT(*) as total
      FROM ${e}
      ${c}
    `,p=`
      SELECT ${s}
      FROM ${e}
      ${c}
      ORDER BY ${n} ${i}
      LIMIT ${o} OFFSET ${(a-1)*o}
    `,[h,f]=await Promise.all([this.query(d,l),this.query(p,l)]),m=parseInt(h.rows[0].total);return{data:f.rows,pagination:{page:Number(a),limit:Number(o),total:m,pages:Math.ceil(m/o)}}},async end(){await n.end(),console.log("Database connection pool has ended")}}},4107:(e,t,r)=>{r.d(t,{dR:()=>o,dy:()=>n,p8:()=>a}),r(8070);class a extends Error{constructor(e){super(e),this.name="ValidationError",this.code="VALIDATION_ERROR"}}class o extends Error{constructor(e="Resource"){super(`${e} not found`),this.name="NotFoundError",this.code="NOT_FOUND"}}function n(e){if(console.error("Database error:",e),"23505"===e.code)throw new a("A record with this information already exists");if("23503"===e.code)throw new a("Referenced record does not exist");if("42P01"===e.code)throw Error("Database schema issue: Table does not exist");throw Error("Database operation failed")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,7145],()=>r(5591));module.exports=a})();